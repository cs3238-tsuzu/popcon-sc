# MySQL
mysql:
    restart: always
    image: mysql
    environment: 
        MYSQL_ROOT_PASSWORD: ${PP_MYSQL_PASSWORD}
        MYSQL_DATABASE: popcon

ppdata:
    image: busybox
    volumes: 
        - ./pp_data:/data
    

# ランキング/ジャッジコントローラ
ppjc:
    build: ppjc

# Webサーバ
ppweb:
    build: ppweb
    volumes_from:
        - ppdata
    links:
        - mysql:mysql
        - ppjc:ppjc
    ports: 
        - 1234:80
    environment:
        PP_MYSQL_ADDR: "root:${PP_MYSQL_PASSWORD}@tcp(mysql:3306)/popcon?charset=utf8"
        PP_JC_ADDR: "http://ppcj:80"
        PP_TOKEN: ${PP_TOKEN}
        PP_LISTEN: ":80"
        PP_DATA_DIR: "/data"
        PP_SETTING: "/data/ppweb/setting.json"
        PP_WAIT_MYSQL: 1